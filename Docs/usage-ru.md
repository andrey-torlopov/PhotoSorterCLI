# Photos Sorter CLI — руководство (RU)

## Введение

Photos Sorter CLI автоматизирует массовую обработку фото- и видеоколлекций. Поскольку утилита может переименовывать, перемещать и обновлять метаданные, начинайте только с резервных копий или тестовых копий. Убедитесь, что процесс полностью соответствует ожиданиям, и лишь потом переходите к основной библиотеке.

## Требования

- macOS 13.0 или новее.
- Разрешение на доступ к папкам, которые вы хотите обрабатывать.
- Рекомендуется иметь внешнюю копию или облачный бэкап оригиналов.

## Установка

1. Скачайте подписанный установщик: [photos-sorter-cli.pkg](../dist/photos-sorter-cli.pkg).  
   При публичном распространении замените ссылку на размещённую версию (например, GitHub Releases).
2. Откройте `.pkg` и выполните шаги мастера установки.
3. После завершения бинарь `photos-sorter-cli` станет доступен из терминала или Spotlight.

## Проверка установки

```bash
photos-sorter-cli --help
```

Если вы видите вывод со справкой, установка прошла успешно. Запустите команду без аргументов, чтобы открыть интерактивное меню.

## Работа с утилитой

1. Подготовьте небольшую тестовую папку, отражающую структуру вашего архива.
2. Запустите `photos-sorter-cli` и выберите нужное действие (0 — выход).
3. Введите пути к исходной и целевой папкам. Лучше использовать абсолютные пути.
4. Перед стартом выполнения внимательно подтвердите сводку настроек.
5. Изучите полученный результат и логи, после чего масштабируйте процесс.

Меню содержит шесть основных операций:

| Опция | Название | Описание |
| --- | --- | --- |
| 1 | Convert DNG to HEIC | Массово конвертирует DNG в HEIC, может удалять оригиналы. |
| 2 | Sort files into folders | Перемещает медиа в структуру `Photos`/`Videos` → `Year` → `Month`, при желании переименовывает в формат `YYYY-MM-DD--HH-mm`. |
| 3 | Fix dates in files | Читает метаданные и обновляет даты создания/изменения файлов. |
| 4 | Set a specific date | Принудительно устанавливает выбранную дату для всех файлов в папке. |
| 5 | Check filename vs metadata | Сравнивает даты в именах файлов с метаданными, выводит список расхождений. |
| 6 | Convert PNG to HEIC | Аналог опции 1, но для PNG. |

## Ожидаемый результат

- **Опции 1 и 6:** В папке появляются HEIC-файлы. Оригиналы остаются или удаляются в зависимости от выбранной опции. В логах отображается статус каждого файла.
- **Опция 2:** Файлы перемещаются в целевую структуру (`Photos`/`Videos` → `Год` → `Месяц`). При включённом переименовании имена меняются на формат даты.
- **Опция 3:** Даты создания и изменения файлов синхронизируются с метаданными. В конце выводятся итоги и ошибки.
- **Опция 4:** Все выбранные файлы получают указанную дату. В логе видно подтверждение каждой операции.
- **Опция 5:** Сформированный отчёт содержит файлы, в которых дата в имени не совпадает с метаданными.

## Чек-лист безопасности

Перед тем как запускать утилиту на всей библиотеке, отрепетируйте процесс на небольшой, но показательной выборке:

1. Обработайте эту тестовую папку через CLI.
2. Проверьте, куда попали файлы, совпадают ли даты создания/изменения и метаданные, откройте несколько конверсий и убедитесь в качестве.
3. Если всё устраивает, постепенно увеличивайте объём до тех пор, пока не будете готовы обработать всю коллекцию.

Дополнительные меры предосторожности:

- Работайте с копиями или резервными копиями, особенно при включённом удалении оригиналов.
- После каждого запуска просматривайте логи и проверяйте предупреждения/ошибки.
- Не включайте потенциально необратимые опции на первых прогонах; используйте их только после полной проверки результата.

## Возможные проблемы

- **Папка недоступна:** Проверьте существование пути и права доступа.
- **Ошибки метаданных:** Некоторые форматы хранят даты иначе; попробуйте временно отключить исправление метаданных или предварительно конвертировать файлы.
- **Сложности с вводом даты:** При запросе укажите точный формат (например, `dd.MM.yyyy HH:mm`), соответствующий вашей строке.
- **Неудачные конверсии HEIC:** Убедитесь, что исходные файлы не повреждены и доступны для чтения; повторите попытку на копии.

## Поддержка

- Автор: Andrey Torlopov
- Email: torlopov.mail@ya.ru
- Лицензия: MIT (см. `../LICENSE`).

При сообщении об ошибках указывайте шаги воспроизведения и, если возможно, прикладывайте примеры файлов.
